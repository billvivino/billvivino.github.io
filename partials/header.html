<!-- /partials/header.html -->
<!-- Shared Header Include for Bill Vivino Blog Posts -->

<!-- Google Tag Manager -->
<script>
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, "script", "dataLayer", "GTM-KNB6ZKLD");
</script>
<!-- End Google Tag Manager -->

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Global Styles -->
<link rel="stylesheet" href="/styles.css" />
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>

<!-- Dynamic Schema + Default Social Tags -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const title =
      document.title ||
      document.querySelector('title')?.innerText ||
      'Bill Vivino Technology';
    const description =
      document
        .querySelector("meta[name='description']")
        ?.getAttribute('content') || 'Bill Vivino Technology Blog';
    const url = window.location.href;
    const image =
      document
        .querySelector("meta[property='og:image']")
        ?.getAttribute('content') ||
      'https://billvivinotechnology.com/assets/logo.png';
    const date =
      document.querySelector('time')?.getAttribute('datetime') ||
      new Date().toISOString();

    // Ensure a canonical link exists
    if (!document.querySelector("link[rel='canonical']")) {
      const link = document.createElement('link');
      link.setAttribute('rel', 'canonical');
      link.setAttribute('href', url.split('#')[0]);
      document.head.appendChild(link);
    }

    // Helper to ensure meta tags (avoids duplicates)
    const ensureMeta = (key, name, content) => {
      const selector = key === 'property' ? `meta[property='${name}']` : `meta[name='${name}']`;
      if (!document.querySelector(selector)) {
        const m = document.createElement('meta');
        if (key === 'property') m.setAttribute('property', name);
        else m.setAttribute('name', name);
        m.setAttribute('content', content);
        document.head.appendChild(m);
      }
    };

    // Open Graph + Twitter cards
    ensureMeta('property', 'og:type', 'article');
    ensureMeta('property', 'og:title', title);
    ensureMeta('property', 'og:description', description);
    ensureMeta('property', 'og:image', image);
    ensureMeta('property', 'og:url', url);
    ensureMeta('name', 'twitter:card', 'summary_large_image');
    ensureMeta('name', 'twitter:title', title);
    ensureMeta('name', 'twitter:description', description);
    ensureMeta('name', 'twitter:image', image);

    // JSON-LD Schema.org
    const schema = {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      headline: title,
      description: description,
      image: [image],
      datePublished: date,
      dateModified: date,
      url: url,
      mainEntityOfPage: {
        "@type": "WebPage",
        "@id": url
      },
      author: { "@type": "Person", name: "Bill Vivino" },
      publisher: {
        "@type": "Organization",
        name: "Bill Vivino Technology, LLC",
        logo: {
          "@type": "ImageObject",
          url: "https://billvivinotechnology.com/assets/logo.png"
        }
      }
    };

    const ld = document.createElement('script');
    ld.type = 'application/ld+json';
    ld.text = JSON.stringify(schema);
    document.head.appendChild(ld);
  });
</script>
